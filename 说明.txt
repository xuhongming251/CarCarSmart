 
用户注册：
id
注册身份为服务器或者客户端。


服务器id登录时，作为服务器端。所有客户端的id的数据都转发给该服务器。
服务器可以给指定客户端id发送数据。
服务器可以广播消息。



客户端id登陆时，需要告诉服务器id登录到哪个服务器上。



中转服务器维护两张大表：

服务器id socket列表:

服务器id socket表中，每个服务器id：
应包含以下信息：

自己的连接socket；
自己的id；
与之相连接的所有客户端的id；



客户端id socket列表：

自己连接的soket；
自己的id；
所连接的目标服务器id；



中转服务器连接管理：

为每个连接上的服务器身份的id开辟两条服务线程。
两线程分别维护处理一个接收消息队列和发送消息队列。

所有向服务器发送的消息都放入接收消息队列。
所有服务器对外发送的消息都放入发送队列。

其中一条线程：
检查接收队列是否有数据，有则发送给服务器。

另一条线程：
检查发送队列是否有数据，有则发送给指定客户端。



中转服务器断开管理：

服务器soket断开，获取该soket对应的id，没有id不处理，直接从表中移除。
有id，获取与之相关联的客户端id和soket，并断开所有soket。把服务器id和相关联的客户端
id全部从表中移除。


客户端soket断开，获取该soket对应的id，






 
用户连接

用户登录

用户注册，通过用户id注册为服务器或者客户端






服务器接受连接

